# Telegram-–±–æ—Ç –Ω–∞ aiogram: –†–∞–±–æ—á–∏–π –ø—Ä–æ–µ–∫—Ç

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî Telegram-–±–æ—Ç, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Python —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ **aiogram** –∏ **sqlalchemy** –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö **PostgreSQL**. –û–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞: –∫–æ–º–∞–Ω–¥—ã, CRUD —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Postgres, –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç (FSM) –¥–ª—è —Ñ–æ—Ä–º, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. –Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ—Å—Ç–≥—Ä–µ—Å –Ω–æ –º–æ–∂–Ω–æ –∏ sqlite, –¥–µ–ª–æ –≤–∫—É—Å–∞ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π.

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- –ö–æ–º–∞–Ω–¥—ã: `/start`, `/profile`, `/form`.
- **Menu-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞** —Å–æ –≤—Å–µ–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.
- **Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞** –≤ —Ñ–æ—Ä–º–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–æ—Ç–º–µ–Ω—ã –¥–∞–Ω–Ω—ã—Ö.
- **FSM** –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –≥–æ—Ä–æ–¥).
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–∞–π–ª `logs.txt`.
- **Orm**, –Ω–∞–ø–∏—Å–∞–Ω–Ω–∞—è –Ω–∞ sqlalchemy –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ø–æ–¥ –±–∏–∑–Ω–µ—Å.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg_bot1/                          # –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ handlers/                     # –ü–∞–ø–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py               # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–æ—É—Ç–µ—Ä—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ tgbot.py
‚îÇ   ‚îú‚îÄ‚îÄ form.py                   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (FSM)
‚îÇ   ‚îú‚îÄ‚îÄ profile.py                # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /profile
‚îÇ   ‚îî‚îÄ‚îÄ start.py                  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
‚îÇ
‚îú‚îÄ‚îÄ database/                     # –ü–∞–ø–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ database.py               # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –∏ –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ models.py                 # –ú–æ–¥–µ–ª–∏ SQLAlchemy (—Ç–∞–±–ª–∏—Ü—ã –ë–î)
‚îÇ   ‚îî‚îÄ‚îÄ queries/
‚îÇ       ‚îî‚îÄ‚îÄ orm.py                # ORM-–º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ
‚îú‚îÄ‚îÄ middleware/                   # Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ logging_middleware.py     # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ config.py                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω –±–æ—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î)
‚îú‚îÄ‚îÄ tgbot.py                      # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ logs.txt                      # –§–∞–π–ª –ª–æ–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
‚îú‚îÄ‚îÄ requirements.txt              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ pyproject.toml                # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞ (Ruff)
‚îî‚îÄ‚îÄ README.md                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

### –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- **`config.py`**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ `.env` —Å –ø–æ–º–æ—â—å—é `python-dotenv`.
- **`tgbot.py`**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–æ—Ç, –ø–æ–¥–∫–ª—é—á–∞–µ—Ç middleware –∏ —Ä–æ—É—Ç–µ—Ä—ã, –∑–∞–ø—É—Å–∫–∞–µ—Ç polling.
- **`middleware.py`**: –õ–æ–≥–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ callback-–∑–∞–ø—Ä–æ—Å—ã –≤ `logs.txt`.
- **`start.py`**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `/start`, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏.
- **`hello.py`**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `/hello`, –æ—Ç–≤–µ—á–∞–µ—Ç "–°–∞–ª–∞–º–∂–µ–∫—Å–æ–Ω".
- **`menu.py`**: –°–æ–∑–¥–∞—ë—Ç reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π.
- **`form.py`**: –†–µ–∞–ª–∏–∑—É–µ—Ç —Ñ–æ—Ä–º—É —Å FSM –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (–∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –≥–æ—Ä–æ–¥).
- **`database.py`**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ SQLAlchemy –∏ —Å–µ—Å—Å–∏–π.
- **`models.py`**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü –ë–î).
- **`queries/orm.py`**: –ú–µ—Ç–æ–¥—ã –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î.

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.10+
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: `aiogram`, `python-dotenv`, `sqlalchemy`
- –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç `@BotFather`
- –ë–î –Ω–∞ –¥–≤–∏–∂–∫–µ `postgresql`

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone <—Å—Å—ã–ª–∫–∞_–Ω–∞_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
   cd tg_bot1
   ```
2. –°–æ–∑–¥–∞–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate     # Windows
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install aiogram python-dotenv
   ```
4. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å —Ç–æ–∫–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ë–î:
   ```
   BOT_TOKEN=your_bot_token_here
   DB_HOST=your_host
   DB_PORT=your_port
   DB_USER=your_username
   DB_NAME=your_database_name
   DB_PASS=your_database_password
   ```
5. –ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç:
   ```bash
   python tgbot.py
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞
- –û—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—ã `/start`, `/form`, `/profile` –≤ Telegram.
- –ü—Ä–æ–≤–µ—Ä—å `logs.txt` –¥–ª—è –∑–∞–ø–∏—Å–µ–π –≤–∏–¥–∞:
  ```
  2025-06-22 12:34:56 | Message | User 123456789: /menu
  2025-06-22 12:35:00 | Callback | User 123456789: Callback: gender_male
  ```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `middleware.py` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ `logs.txt`.

- **–§–æ—Ä–º–∞—Ç**:
  ```
  2025-06-22 12:34:56 | Message | User 123456789: /menu
  2025-06-22 12:35:00 | Callback | User 123456789: Callback: gender_male
  ```
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**:
  ```python
  middleware_logger = logging.getLogger("bot_middleware")
  middleware_handler = logging.FileHandler("logs.txt")
  middleware_formatter = logging.Formatter(
      "%(asctime)s | %(log_type)s | User %(user_id)s: %(log_content)s"
  )
  middleware_handler.setFormatter(middleware_formatter)
  middleware_logger.addHandler(middleware_handler)
  middleware_logger.setLevel(logging.INFO)
  middleware_logger.propagate = False
  ```

